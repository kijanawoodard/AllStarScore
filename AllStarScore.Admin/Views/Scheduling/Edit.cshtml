@model AllStarScore.Admin.ViewModels.SchedulingEditViewModel

@{ Html.RegisterStylesheet("~/content/styles/scheduling.edit.css"); }
@{ Html.RegisterScript("~/content/scripts/scheduling.edit.js"); }

<div id="scheduling_edit">
    <h2>Schedule for @Html.ActionLink(Model.Competition.Display, "Details", "Competition", new { id = Model.Competition.Id.ForMvc() }, new { })</h2>
    <div class="setup">
        <a href="#" data-bind="visible: !displayOptions(), click: toggleOptions">Show Options</a>
        <a  href="#" data-bind="visible: displayOptions, click: toggleOptions">Hide Options</a>    
        <div data-bind='fadeVisible: displayOptions'>
            <div class="option">
                <div>How many panels do you want? <span data-bind="text: panels().length"></span>: <span data-bind="text: panels"></span></div>
                <div data-bind="ko_slider: { source: schedule.numberOfPanels, options: { step: 1, max: 6}}" class="slider"></div>
            </div>
            <div class="option">
                <div>How many performances for each team? <span data-bind="text: schedule.numberOfPerformances"></span></div>
                <div data-bind="ko_slider: { source: schedule.numberOfPerformances, options: { step: 1, max: 2}}" class="slider"></div>
            </div>
        </div>
        <br/>
    </div>
    
    <div class="performances">
        <div class="scheduled">
            <div data-bind="foreach: schedule.days">
                <span data-bind="dateString: day, datePattern: 'dddd MMM dd, yyyy'"></span>
                <a href="#" data-bind="click: $root.addBreak">Add Break</a>
                <a href="#" data-bind="click: $root.addAwards">Add Awards</a>
                <a href="#" data-bind="click: $root.addOpen">Add Open</a>
                <ol data-bind="sortable: { template: 'scheduled-template', data: entries, options: { tolerance: 'pointer', placeholder: 'ui-state-highlight', handle: '.handle', containment: '.performances' } }" class="sortable"></ol>
            </div>
        </div>
        <div class="unscheduled" data-bind="visible: unscheduled().length > 0">
            <p><span data-bind="text: unscheduled().length"></span> performances haven't been scheduled</p>
            <ol data-bind="sortable: { template: 'scheduled-template', data: unscheduled, options: { tolerance: 'pointer', placeholder: 'ui-state-highlight', handle: '.handle', containment: '.performances' } }" class="sortable"></ol>
        </div>
    </div>
    
    <form action='@Url.Action("Edit", "Scheduling")' method="post">
        <fieldset>
            <legend>Save Schedule</legend>
            
            <div class="validation-summary-errors"></div>

            <p class="save">
                <button data-bind="click: save, enable: unscheduled().length > -1">Save</button>
                <span class="notification" data-bind="fadeVisible: justSaved">Saved!</span>
            </p>
        </fieldset>
    </form>

    <pre data-bind="text: ko.toJSON($root, null, 2)"></pre>
</div>

<script type="text/html" id="scheduled-template">
    <li>
        <div class="index" data-bind="text: $index() + 1 + '.', syncIndex: index($index())"></div>
        <div class="wrap ui-corner-all">
            <div class='handle'><span class='ui-icon ui-icon-star'></span></div>
            <span class="display" data-bind="css: { break: isNonTeamEntry}">
                <span class="group">
                    <span data-bind="dateString: warmup, datePattern : 'ddd h:mm tt'" class="warmup"></span>
                    <span data-bind="dateString: time, datePattern: 'ddd h:mm tt'"></span>
                    <span data-bind="text: $root.getPanel($data), click: $root.shiftPanel" class="shift-panel"></span>
                </span>
                <span data-bind="template: { name: template(), data: $root.toPerformance($data) }" class="core"></span>
@*                <!-- ko template: { name: template(), data: $data.registration() || $data } --><!-- /ko -->*@
                <span data-bind="text: $root.toPerformance($data).order" class="order"></span>
@*                <span data-bind="text: duration"></span>*@
            </span>
        </div>
    </li>
</script>

<script type="text/html" id="registration-template">
    <span class="name group">
        <span data-bind="text: gym"></span>
        <span data-bind="text: team"></span>
        <span data-bind="text: isShowTeam ? 'Show' : ''" class="show"></span>
    </span>
    <span class="division group">
        <span data-bind="text: level"></span>
        <span data-bind="text: division"></span>
    </span>
    
    @*    <span data-bind="text: participantCount"></span>*@
    @*    <span data-bind="text: gymLocation"></span>*@
    @*    <span data-bind="text: isSmallGym ? 'Small' : 'Large'"></span>*@
    
    @*    <span data-bind="text: viewModel.performancesToBeScheduled(id)"></span>*@
</script>

<script type="text/html" id="block-template">
    <span data-bind="text: text"></span>
</script>

<script>
    var editScheduleData = JSON.parse('@Html.Raw(Model.ToJson())');
</script>