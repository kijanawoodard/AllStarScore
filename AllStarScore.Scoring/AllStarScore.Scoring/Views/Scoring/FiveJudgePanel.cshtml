@model AllStarScore.Scoring.ViewModels.ScoringFiveJudgePanelViewModel

@{
    ViewBag.Title = "Team Score Summary";
}

@{ Html.RegisterStylesheet("~/content/styles/scoring.fivejudgepanel.css"); }
@{ Html.RegisterScript("~/content/scripts/scoring.fivejudgepanel.js"); }

<h2>@ViewBag.Title</h2>

<div id="scoring_fivejudgepanel">
    <div data-bind="with: viewModel.performance" class="header">
        <div class="company">Spirit Celebration</div>
        <div class="description">CGA National Championship Feb 12-13, 2011</div>
        <div class="name">
            <span data-bind="text: gymName"></span>
            <span data-bind="text: teamName"></span>
        </div>
        <div class="division">
            <span data-bind="text: levelName"></span>
            <span data-bind="text: divisionName"></span>
        </div>
        <div data-bind="dateString: performanceTime, datePattern: 'ddd h:mm tt'" class="when"></div>     
    </div>
        
    <!-- ko template: { name: viewModel.getTemplate, data: viewModel.getScoring(viewModel.performance, viewModel.judges) } --><!-- /ko -->

    <table class="final_score">
        <tbody data-bind="with: viewModel">
            <tr>
                <th>Average</th>
                <td data-bind="text: calculator.averagePanelScore().toFixed(3)"></td>
            </tr>
            <tr>
                <th>Point Deductions</th>
                <td data-bind="text: judges()[3] && judges()[3].grandTotal">1</td>
            </tr>
            <tr>
                <th>Safety Deductions</th>
                <td data-bind="text: judges()[4] && judges()[4].grandTotal">1</td>
            </tr>
            <tr>
                <th>Final Score</th>
                <td data-bind="text: calculator.finalScore().toFixed(3)"></td>
            </tr>
        </tbody>
    </table>
    
    <nav data-bind="with: viewModel.performance">
        <ul>
            <li>
                <a href="@Url.Action("ScoreEntry", "Scoring", new { performanceId = @Model.Performance.Id, judgeId = "1"})">
                    <span data-bind="text: panel"></span>1
                </a>
            </li>
            <li>
                <a href="@Url.Action("ScoreEntry", "Scoring", new { performanceId = @Model.Performance.Id, judgeId = "2"})">
                    <span data-bind="text: panel"></span>2
                </a>
            </li>
            <li>
                <a href="@Url.Action("ScoreEntry", "Scoring", new { performanceId = @Model.Performance.Id, judgeId = "3"})">
                    <span data-bind="text: panel"></span>3
                </a>
            </li>
            <li>
                <a href="@Url.Action("ScoreEntry", "Scoring", new { performanceId = @Model.Performance.Id, judgeId = "D"})">
                    <span data-bind="text: panel"></span>D
                </a>
            </li>
            <li>
                <a href="@Url.Action("ScoreEntry", "Scoring", new { performanceId = @Model.Performance.Id, judgeId = "L"})">
                    <span data-bind="text: panel"></span>L
                </a>
            </li>
        </ul>
    </nav>

    <pre data-bind="text: ko.toJSON($root, null, 2)" class="ko_output"></pre>
</div>

<script>
    var scoringFiveJudgePanelData = JSON.parse('@Html.Raw(Model.ToJson())');
</script>

<script type="text/html" id="all-star-template">
    <table class="score_summary">
        <thead>
            <tr data-bind="with: performance.panel">
                <th class="skills">Skills</th>
                <th class="judge"><span data-bind="text: $data"></span>1</th>
                <th class="judge"><span data-bind="text: $data"></span>2</th>
                <th class="judge"><span data-bind="text: $data"></span>3</th>
            </tr>
        </thead>
        <tbody>
            <!-- ko foreach: $data.categories -->
            <tr>
                <td  data-bind="text: category.display"></td>
                <td data-bind="text: $parent.judges()[0] && $parent.judges()[0].scores[key].total().toFixed(1)"></td>
                <td data-bind="text: $parent.judges()[1] && $parent.judges()[1].scores[key].total().toFixed(1)"></td>
                <td data-bind="text: $parent.judges()[2] && $parent.judges()[2].scores[key].total().toFixed(1)"></td>
            </tr>
            <!-- /ko -->
            <tr>
                <th>Total</th>
                <th data-bind="text: judges()[0] && judges()[0].grandTotal().toFixed(1)"></th>
                <th data-bind="text: judges()[1] && judges()[1].grandTotal().toFixed(1)"></th>
                <th data-bind="text: judges()[2] && judges()[2].grandTotal().toFixed(1)"></th>
            </tr>
        </tbody>
    </table>
</script>